"A datetime string with format `Y-m-d H:i:s`, e.g. `2018-05-23 13:43:32`."
scalar DateTime @scalar(class: "Nuwave\\Lighthouse\\Schema\\Types\\Scalars\\DateTime")

"Indicates what fields are available at the top level of a query operation."
type Query {
    "Find a single user by an identifying attribute."
    user(
      "Search by primary key."
      id: ID @eq @rules(apply: ["prohibits:email", "required_without:email"])

      "Search by email address."
      email: String @eq @rules(apply: ["prohibits:id", "required_without:id", "email"])
    ): User @find

    "List multiple users."
    users(
      "Filters by name. Accepts SQL LIKE wildcards `%` and `_`."
      name: String @where(operator: "like")
    ): [User!]! @paginate(defaultCount: 10)
}



type Role {
  id: ID!
  nom: String!
  slug: String
  users: [User!]! @hasMany
}

type User {
  id: ID!
  name: String!
  email: String!
  is_admin: Boolean!
  role: Role! @belongsTo
  livres: [Livre!]! @hasMany
}

type Login {
  access_token: String!
  user: User!
}

type Categorie {
  id: ID!
  nom: String!
  slug: String!
  livres: [Livre!]! @hasMany
}

type Livre {
  id: ID!
  titre: String!
  description: String!
  date_sortie: String!
  slug: String!
  categorie: Categorie! @belongsTo
  user: User! @belongsTo
}

type Query {
  roles: [Role!]! @all
  users: [User!]! @all
  categories: [Categorie!]! @all
  livres: [Livre!]! @all
  livre(slug: ID!): Livre @find(model: "App\\Models\\Livre", key: "slug")
}


type Mutation {
  # Roles
  createRole(nom: String!): Role @create @isAdmin @guard(checks: ["auth:sanctum"])
  updateRole(slug: ID!, nom: String): Role @update @isAdmin @guard(checks: ["auth:sanctum"])
  deleteRole(slug: ID!): Role @delete @isAdmin @guard(checks: ["auth:sanctum"])

  # Categories
  createCategorie(nom: String!): Categorie @create @isAdmin @guard(checks: ["auth:sanctum"])
  updateCategorie(slug: ID!, nom: String): Categorie @update @isAdmin @guard(checks: ["auth:sanctum"])
  deleteCategorie(slug: ID!): Categorie @delete @isAdmin @guard(checks: ["auth:sanctum"])

  # Livres
  createLivre(
    titre: String!
    description: String!
    date_sortie: String!
    categorie_id: ID!
  ): Livre @field(resolver: "App\\GraphQL\\Mutations\\LivreMutator@create") @IsAuthor @guard(checks: ["auth:sanctum"])

  updateLivre(
    slug: ID!
    titre: String
    description: String
    date_sortie: String
    categorie_id: ID
  ): Livre @field(resolver: "App\\GraphQL\\Mutations\\LivreMutator@updateBySlug") @isLivreeowner @guard(checks: ["auth:sanctum"])

  deleteLivre(
    slug: ID!
  ): Livre @field(resolver: "App\\GraphQL\\Mutations\\LivreMutator@deleteBySlug") @isLivreeowner @guard(checks: ["auth:sanctum"])

  # Utilisateur
  register(
    name: String!
    email: String!
    password: String!
    password_confirmation: String!
    role_id: ID!
  ): User @field(resolver: "App\\GraphQL\\Mutations\\UserMutator@register")

  login(
  email: String!
  password: String!
  remember_me: Boolean
  ):Login @field(resolver: "App\\GraphQL\\Mutations\\UserMutator@login")


  sendVerificationEmail: MessageResponse @field(resolver: "App\\GraphQL\\Mutations\\UserMutator@sendVerificationEmail") @guard
  verifyEmail(token: String!, email: String!): MessageResponse @field(resolver: "App\\GraphQL\\Mutations\\UserMutator@verifyEmail")
  forgotPassword(email: String!): MessageResponse @field(resolver: "App\\GraphQL\\Mutations\\UserMutator@forgotPassword")
  resetPassword(
    token: String!,
    email: String!,
    password: String!,
    password_confirmation: String!
  ): MessageResponse @field(resolver: "App\\GraphQL\\Mutations\\UserMutator@resetPassword")
  changePassword(
    current_password: String!,
    password: String!,
    password_confirmation: String!
  ): MessageResponse @field(resolver: "App\\GraphQL\\Mutations\\UserMutator@changePassword") @guard
}

type MessageResponse {
  message: String!
}
